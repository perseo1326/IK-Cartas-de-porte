<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUP Cartas de Porte</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400;700&display=swap" rel="stylesheet">

    <style>
        

*, *:after, *:before {
    --background: white;
    --first-color: #0057a4;
    --second-color: #ffdb01;
    --warning-color: rgba(255, 165, 0, 1);
    --doc-font: 8px;
    padding: 0;
    margin: 0;
    font-family: 'Roboto', sans-serif;
    font-size: 16px;
    box-sizing: border-box;
}

.warning {
    background-color: var(--warning-color);
}

body {
    background-color: var(--background);
    padding: 0.5rem;
}

.back1 {
    background-color: aqua;
}

.back2 {
    background-color: orange;
}

div.container-column {
    padding: 0 0.5rem;
    display: flex;
    flex-direction: column;
}

.container {
    display: flex;
}

.no-visible {
    display: none;
}

.show-print{
    display: none;
}

.inline {
    display: inline-block;
}

.margen-alto-05 {
    margin-top: 0.5rem;
}

.margen-izq-1 {
    margin-left: 1rem;
}

.ancho-100 {
    width: 100%;
}

.ancho-50 {
    width: 50%;
}

.ancho-60 {
    width: 60%;
}

.margen-bajo-05 {
    margin-bottom: 0.5rem;
}

.margen-bajo-1 {
    margin-bottom: 1rem;
}

.centrar {
    text-align: center;
}

h1 {
    font-weight: bolder;
}

label {
    display: inline-block;
}

div p.version {
    text-align: right;
    padding: 0.3rem 1rem;
    font-size: 0.7rem;
    color: gray;
}

.custom-button {
    border: none;
    border-radius: 4px;
	background-color: var(--first-color);
	color: var(--second-color);
	cursor: pointer;
	font-size: 1rem;
	margin: 0.3rem auto;
	padding: 0.3rem 0.6rem;
	text-align: center;
}

.custom-button:hover {
    background-color: var(--second-color);
    color: var(--first-color)
}

.disable {
    background-color: lightgray;
    color: black;
    cursor: not-allowed;
}

.disable:hover {
    background-color: lightgray;
    color: orangered;
}

input[type="file"] {
    display: none;
}

/*
div.loading-frame {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* background-color: rgba(0, 0, 0, 0.5); */
/*    backdrop-filter: blur(5px);
    /* background-color: hsla(210, 4%, 20%, 0.5); */
/* 
}

div.loading-frame div.loading {
	position: relative;
	background-color: var(--first-color);
    color: var(--second-color);
    text-align: center;
    max-width: 40%;
    margin : auto;
    top: 50%;
	padding: 2rem ;
    border-radius: 5px;
    transform: translate(-0%, -50%);
    -webkit-transform: translate(-0%, -50%);
}

div.loading p {
    margin: auto;
    font-weight: bold;
    font-size: larger;
}

/* ***** TABLE STYLES ***** */

strong {
    font-weight: bold;
}

table {
    width: 100%;
    border-collapse: collapse;
    border: 2px solid var(--first-color);
}

thead tr th {
    padding: 0.1rem;
    border-bottom: 2px solid var(--first-color);
}

thead tr th.ordinal {
    width: 4rem;
}

thead tr th.isell {
    width: 20%;
}

table tbody#data-body tr.warning-row {
    background-color: orange !important;
}

table tbody#data-body tr td {
    border-bottom: 1px solid gray;
    min-width: 5rem;
    max-height: 1rem;
}

table tbody#data-body tr:nth-last-of-type(2n+0) {
    background-color: lightgray;
}

table tbody#data-body tr:hover {
    background-color: var(--second-color);
}

.cabecera {
    background-color: var(--first-color);
    color: var(--second-color);
}

table tbody#data-body tr.totales {
    font-weight: bolder;
}

/* ***** TABLE DOCUMENT HEADER STYLES  ***** */

body.page-a4 {
    /* width: 21cm;
    height: 29.7cm;
    border: 0.5px dotted black; */
}

table tbody#transport-document-info tr td.title {
    border-right: 1px solid transparent;
}

table tbody#transport-document-info tr td.page-number {
    font-size: 6px;
    text-align: right;
    padding: 0 0.5rem;
    vertical-align: top;
}

table tbody#transport-document-info tr td h3 {
    text-align: right;
    padding: 0.5rem;
    font-size: large;
}

table tbody#transport-document-info tr td {
    font-size: var(--doc-font);
    padding: 0.2rem;
    border: 1px solid black;
}

table tbody#transport-document-info tr td.value {
    text-align: center;
    font-size:small;
}

table tbody#transport-document-info tr td p {
    /* font-size: small; */
}

table tbody#transport-document-info tr td p.note {
    font-size: var(--doc-font);
    text-align: justify;
}

table tbody#transport-document-info tr td.text-top-left {
    text-align: left;
    vertical-align: text-top;
}

.blank-space {
    height: 4rem;
}

.blank-space-big {
    height: 6rem;
}

/* ***** FOOTER TABLE STYLES ***** */

table tbody#footer-table tr td {
    font-size: var(--doc-font);
    padding: 0.2rem;
    border: 1px solid black;
}

div p.footer-page {
    font-size: var(--doc-font);
    font-style: italic;
    text-align: right;
}
/* ***** TABLE STYLES ENDS ***** */


/* ***** PRINTABLE STYLES ***** */

@media print {

    *, *:after, *:before {
        --background: transparent;
        --first-color: black;
        --second-color: black;
        --warning-color: rgba(255, 165, 0, 1);
        /* --doc-font: 8px; */
        padding: 0;
        margin: 0;
        font-size: 10px;
        /* box-sizing: border-box; */
    }
    body, html {
        /* background-color: transparent !important; */
        color: black !important;
    }

    .hide-print {
        display: none !important;
    }

    .show-print {
        display: block;
    }

    .cabecera {
        background-color: rgb(199, 199, 199);
        border-bottom: 1px solid black;
        /* color: black; */
    }

    table tbody#data-body tr td {
        background-color: transparent;
    }

    table.print-hide-borders {
        border-top: none;
        border-bottom: none;
    }

    p.version {
        print-color-adjust: exact;
        -webkit-print-color-adjust:exact;
        color: gray;
    }
}

/* ***** PRINTABLE STYLES ENDS ***** */

    </style>
</head>
<body class="page-a4">
    <div class="container-column">
        <div class="hide-print ancho-100 margen-bajo-1">
            <h1 class="centrar">Cartas de Porte Pick Up Points </h1>
        </div>

        <!-- Cabecera seleccion de info -->
        <div class="hide-print margen-bajo-1 ancho-100">
            <!-- File selection -->
            <div class="ancho-100">
                <label class="" for="">1. Seleccionar archivo de datos:</label>
                <div class="ancho-100 margen-izq-1">
                    <label class="custom-button" id="upload-file-b" for="file-input" >Subir archivo...</label>
                    <input type="file" class="" id="file-input" value="" />
                </div>
            </div>

            <!-- Date selection -->
            <div class="ancho-100">
                <label class="" for="">2. Fecha (CUT OFF DATE):</label>
                <div class="ancho-100 margen-izq-1">
                    <input type="date" id="selected-date" class="custom-button disable" disabled>
                </div>
            </div>

            <div class="container">
                <!-- destino -->
                <div class="ancho-50 inline">
                    <label for="">3. Seleccione el destino (CUT OFF TIME):</label>
                    <div class="ancho-100 margen-izq-1">
                        <select id="destino-cut-off-time" name="destinos" class="custom-button disable" disabled>
                            <!-- <option value="" >Selecciona un valor </option> -->
                            <option value="DIAGONAL">Diagonal</option>
                            <option value="SANT_PERE">Sant Pere</option>
                            <option value="TARRAGONA">Tarragona</option>
                        </select>
                    </div>
                </div>
                
                <!-- window service furgo No. -->
                <div class="ancho-50 inline">
                    <label for="">4. Seleccione el Service Window:</label>
                    <div class="ancho-100 margen-izq-1">
                        <select id="service-window" name="" class="custom-button disable" disabled>
                            <!-- <option value="" >Selecciona un valor </option> -->
                            <option value="_ONE">Primera Furgo</option>
                            <option value="_TWO">Segunda Furgo</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Process info -->
            <div class="ancho-50 inline">
                <label for="">5. Analizar información</label>
                <div class="ancho-100 margen-izq-1">
                    <input type="button" id="process-data" class="custom-button disable" value="Procesar información" disabled>
                </div>
            </div>

            <!-- Print documents -->
            <div class="ancho-50 inline">
                <label for="">6. Imprimir Documentación</label>
                <div class="ancho-100 margen-izq-1">
                    <input type="button" id="print-documentation-b" class="custom-button _disable" value="Imprimir Documentación" >
                </div>
            </div>
        </div>

        <div class="show-print">
            <!-- Container for the whole document header -->
            <table>
                <tbody id="transport-document-info">
                    <tr>
                        <td class="ancho-50 title">
                            <h3>Carta de Porte / Transport Document</h3></td>
                        <td class="page-number" colspan="2">Página 1 de 1<br>Page 1 of 1</td>
                    </tr>
                    <tr>
                        <td>No. Carta de porte / Transport document number</td>
                        <td>Fecha de carga / Date of loading</td>
                        <td>Fecha de entrega / Date of receipt</td>
                    </tr>
                    <tr>
                        <td class="value">406SP 06/03/2023 SANT PERE (FURGO 1)</td>
                        <td class="value">06/03/2023</td>
                        <td class="value">06/03/2023</td>
                    </tr>
                    <tr>
                        <td class="">Remitente / Sender</td>
                        <td colspan="2">No. de precinto</td>
                    </tr>
                    <tr>
                        <td>
                            <p><strong>Ikea Gran Via 406</strong></p>
                            <p>Gran Via de l'Hospitalet 115-133</p>
                            <p>Hospitalet de Llobregat 08908</p>
                            <p>Barcelona, Espanya</p>
                        </td>
                    </tr>
                    <tr>
                        <td>Destinario / Consignee</td>
                        <td colspan="2">Transportista / Carrier</td>
                    </tr>
                    <tr>
                        <td>
                            <p><strong>Ikea St Pere Planning Studio</strong></p>
                            <p>Rambla del Garraf s/n, Parc d'Oci Les Roquetes Local 10-B2</p>
                            <p>El Mas d'en Serra, 08812</p>
                            <p>Barcelona, Espanya</p>
                        </td>
                        <td colspan="2">
                            <p><strong>SAMA Logística Aplicada SL</strong></p>
                            <p>Gran Via de l'Hospitalet 115-133</p>
                            <p>Hospitalet de Llobregat 08908</p>
                            <p>Barcelona, Espanya</p>
                        </td>
                    </tr>
                    <tr>
                        <td>Número de albarán / Invoice number</td>
                        <td colspan="2">Matrícula Vehículo / Trailer registration</td>
                    </tr>
                    <tr>
                        <td class="blank-space"></td>
                        <td class="blank-space" colspan="2"></td>
                    </tr>
                    <tr class="">
                        <td>
                            <p class="note">El conductor, mediante su firma declara que durante las operaciones de carga se ha seguido una relación de comprobaciones relativa a la carga de las mercancías peligrosas, habiendo iniciado el transporte cumpliendo con todos los requisitos exigibles por el ADR.</p>
                            <p class="note">The driver, by signing states that during the loading a dangerous goods check-list has been completed, initiating transport in compliance with all applicable requirements of the ADR.</p>
                        </td>
                        <td class="text-top-left" colspan="2" >Firma del conductor / Driver's signature</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div>
            
            <!-- Table with data -->
            <table class="print-hide-borders">
                <thead>
                    <tr class="cabecera">
                        <th class="centrar ordinal">No.</th>
                        <th class="isell">Isell</th>
                        <th class="hide-print">Estado</th>
                        <th class="">No. Paquetes</th>
                        <th class="">Peso (Kg)</th>
                        <th class="">Volumen (m<sup>3</sup>)</th>
                    </tr>
                </thead>
                <tbody id="data-body">
                </tbody>
            </table>
        </div>
            
        <div class="show-print">
            <!-- Footer table -->
            <table>
                <tbody id="footer-table">
                    <tr>
                        <td class="centrar" colspan="3">Observaciones de la expedición / Shipping remarks</td>
                    </tr>
                    <tr>
                        <td class="blank-space" colspan="3"></td>
                    </tr>
                    <tr>
                        <td>Firma y sello Expedidor</td>
                        <td>Firma y sello Transportista</td>
                        <td>Firma y sello Destinatario</td>
                    </tr>
                    <tr>
                        <td class="blank-space-big"></td>
                        <td class="blank-space-big"></td>
                        <td class="blank-space-big"></td>
                    </tr>
                </tbody>
            </table>

            <div>
                <p class="footer-page">Imprimir 3 copias: 1 Consignatario, 1 transportista y 1 receptor.</p>
            </div>
        </div>

    </div>

        <!-- Version de la aplicacion -->
        <div>
            <p class="version">Versión 1.0</p>
        </div>
    </div>
    <script>


    /*

        filtrar por flujo de mercancia = PUP
        obtener los cut of time para inicalizar la visualizacion 
        
        seleccionar fecha = CUT_OFF_DATE
        seleccionar el destino, Diagonal, Tarragona, Sant Pere = CUT_OFF_TIME
        

        ACTUAL_ORDER_STATUS = 
            Not Started
            Started
            Picking
            Picked
            Wait for Merge
            Check Started
            Checked
            Completed
            Open Return
            Returned
    */
        /* 
            ISELL_ORDER_NUMBER
            PICK_ID
            ORDER_TYPE
            PACKAGES
            WEIGHT
            VOLUME
            ORDERED_QTY
            PICK_AREA
            ACTUAL_ORDER_STATUS
            * CANCELLED
            * NOT_HANDED_OUT
            CUT_OFF_DATE
            CUT_OFF_TIME
            SERVICE_WINDOW
            */

            
    // *********************************************************
    // Variables y constantes
    const fileSelector = document.getElementById('file-input');
    const selectedDate = document.getElementById("selected-date");
    const cutOffTimeSelector = document.getElementById("destino-cut-off-time");
    const serviceWindowSelector = document.getElementById("service-window");
    const processDataB = document.getElementById("process-data");
    const printDocumentationB = document.getElementById("print-documentation-b");


    const tableBody = document.getElementById("data-body");

    const fileReader = new FileReader();
    let contentOriginal = [];
    const todayDate = new Date("2023-02-25");

    const NOT_STARTED       = "Not Started";
    const STARTED           = "Started";
    const PICKING           = "Picking";
    const PICKED            = "Picked";
    const WAIT_FOR_MERGE    = "Wait for Merge";
    const CHECK_STARTED     = "Check Started";
    const CHECKED           = "Checked";
    const COMPLETED         = "Completed";
    const OPEN_RETURN       = "Open Return";
    const RETURNED          = "Returned";

    const CUT_OFF_TIME = new Map();
    CUT_OFF_TIME.set("DIAGONAL", "06:30");
    CUT_OFF_TIME.set("SANT_PERE", "20:00");
    CUT_OFF_TIME.set("TARRAGONA", "19:45");

    const WINDOW_SERVICE = new Map();
    // WINDOW_SERVICE.set("DIAGONAL_ONE", []);
    // WINDOW_SERVICE.set("DIAGONAL_TWO", []);
    WINDOW_SERVICE.set("SANT_PERE_ONE", ["10:00-13:00", "13:00-16:00"]);
    WINDOW_SERVICE.set("SANT_PERE_TWO", ["16:00-19:00", "19:00-21:00"]);
    WINDOW_SERVICE.set("TARRAGONA_ONE", ["10:00-13:00", "13:00-17:00"]);
    WINDOW_SERVICE.set("TARRAGONA_TWO", ["17:00-19:00", "19:00-21:00"]);

    // *********************************************************
    
    class PickOrder {
        constructor(pickId, packages, weight, volume, orderedQty, pickArea, actualOrderStatus, cancelled, notHandedOut ) {
            this.pickArea       = pickArea;
            this.pickId         = pickId;
            this.packages       = Number (packages.replace(',', '.'));
            this.weight         = Number (weight.replace(',', '.'));
            this.volume         = Number (volume.replace(',', '.'));
            this.orderedQty     = Number (orderedQty.replace(',', '.'));
            this.actualOrderStatus = actualOrderStatus;
            this.cancelled      = cancelled;
            this.notHandedOut  = notHandedOut;
        }
    }

    class OrderPUP {
        constructor(isellOrderNumber, cutOffDate, cutOffTime, serviceWindow, pickOrder) {
            this.isellOrderNumber   = isellOrderNumber;
            this.cutOffDate         = cutOffDate;
            this.cutOffTime         = cutOffTime;
            this.serviceWindow      = serviceWindow;
            this.pickOrder          = new Map();
            this.pickOrder.set(pickOrder.pickArea, pickOrder);
            this.totalPackages      = Number (0.0);
            this.totalWeight        = Number (0.0);
            this.totalVolume        = Number (0.0);
            this.status             = STARTED;
        }

        addPickOrder(pickOrder) {
            if(this.pickOrder.has(pickOrder.pickArea)) {
                console.log("ERROR: picking task ya existente! ID = " + pickOrder.pickId);
                alert("ERROR: picking task ya existente! ID = " + pickOrder.pickId);
                return;
            }
            this.pickOrder.set(pickOrder.pickArea, pickOrder);
        }

        calculateTotals() {
            // Initialize variables
            this.totalPackages      = 0.0;
            this.totalWeight        = 0.0;
            this.totalVolume        = 0.0;

            this.setStatusOrder();

            if(this.status === RETURNED) {
                return;
            }

            this.pickOrder.forEach( (value,key) => {
                this.totalPackages      += value.packages;
                this.totalWeight        += value.weight;
                this.totalVolume        += value.volume;
            } );
        }

        setStatusOrder() {
            this.pickOrder.forEach( (value, key) => {
                if (value.actualOrderStatus === OPEN_RETURN || value.actualOrderStatus === RETURNED ) {
                    this.status = RETURNED;
                }
            });
        }

        // toString() {
        //     let string = "Isell: " + this.isellOrderNumber + "\n";
        //     string += "Cut of Date: " + this.cutOffDate + "\n";
        //     string += "Cut of Time: " + this.cutOffTime + "\n";
        //     string += "Service Window: " + this.serviceWindow + "\n";
        //     return string;
        // }
    }

    // *********************************************************
    selectedDate.valueAsDate = todayDate;

    // *********************************************************
    // Event Listeners 
    fileSelector.addEventListener('change', openFile); 
    processDataB.addEventListener('click', processData);
    printDocumentationB.addEventListener('click', printDocument);

    
    
    // *********************************************************
    // Function to validate a given date
    function validateDate() {
        const date = selectedDate.valueAsDate;
        if(!date ){
            console.log("La fecha seleccionada es inválida.");
            alert("La fecha seleccionada es inválida.");
            return false;
        } 
        return selectedDate.value;
    }

    // *********************************************************
    // Verifica el archivo seleccionado        
    function verifyFileExist(file) {
        if (!file) {
            alert("No se ha seleccionado ningun archivo.");
            console.log("No se ha seleccionado ningun archivo.");
            return null;
        }
        /*
        if (file.type && !file.type.startsWith('text/')) {
            alert('El archivo seleccionado NO es válido.');
            console.log('El archivo seleccionado NO es válido.');
            return null;
        }
        */
        return file;
    }

    // *********************************************************
    function openFile(evento) {
        console.clear();
        let file = evento.target.files[0];

        file = verifyFileExist(file);
        if(!file) {            
            return;
        }

        fileReader.readAsText(file, "windows-1252");
        document.getElementById("upload-file-b").innerText = file.name;
        fileReader.onload = loadFile;
    }
    
    // *********************************************************
    // load the content of the file to memory
    function readDataFromFile (fileData) {
        // Divide info into rows and columns
        let rows = fileData.split('\n');
        let columns = [];
        let originalData = [];
        rows.forEach(row => {
            columns = row.split('\t');
            originalData.push(columns);
        });
        return originalData;
    }

    // *********************************************************
    // Verify the valid structure of data readed from the file based on the headers of info
    function validateContent(arrayRow) {

        if (arrayRow[0].trim() == "ISELL_ORDER_NUMBER" && 
            arrayRow[1].trim() == "PICK_ID" && 
            arrayRow[3].trim() == "ORDER_TYPE" && 
            arrayRow[5].trim() == "PACKAGES" && 
            arrayRow[6].trim() == "WEIGHT" && 
            arrayRow[7].trim() == "VOLUME" && 
            arrayRow[12].trim() == "PICK_AREA" && 
            arrayRow[38].trim() == "CUT_OFF_DATE" && 
            arrayRow[39].trim() == "CUT_OFF_TIME" && 
            arrayRow[42].trim() == "SERVICE_WINDOW" ) {
                return true;
        } 
        return false;
    }

    // *********************************************************
    // Clean all invalid final lines read from the file.
    function deleteInvalidFinalLines(dataArray, totalColumns) {
        if (dataArray[dataArray.length - 1].length < totalColumns) {
            dataArray.pop();
            deleteInvalidFinalLines(dataArray, totalColumns);
        }
        return dataArray;
    }

    // *********************************************************
    // Remove all unnecessary columns from the matrix data
    function filterColumns(dataMatrix) {
        /* 
            ISELL_ORDER_NUMBER
            PICK_ID
            ORDER_TYPE
            PACKAGES
            WEIGHT
            VOLUME
            ORDERED_QTY
            PICK_AREA
            ACTUAL_ORDER_STATUS
            * CANCELLED
            * NOT_HANDED_OUT
            CUT_OFF_DATE
            CUT_OFF_TIME
            SERVICE_WINDOW
            */

        let objectsArray = [];
        dataMatrix.forEach( row => {
            const order = [];
                order.push(row[0].trim());
                order.push(row[1].trim());
                order.push(row[3].trim());
                order.push(row[5].trim());
                order.push(row[6].trim());
                order.push(row[7].trim());
                order.push(row[8].trim());
                order.push(row[12].trim());
                order.push(row[13].trim());
                order.push(row[23].trim());
                order.push(row[24].trim());
                order.push(row[38].trim());
                order.push(row[39].trim());
                order.push(row[42].trim());
            objectsArray.push(order);
        });
        return objectsArray;
    }

    // *********************************************************
    // Check and remove all elements with "Order Type" different that "PUP"
    function filterOrderTypeOnlyPUP(dataArray) {
        return dataArray.filter( (row) => { return row[2] == "PUP" } );
    }

    // *********************************************************
    function loadFile() {
        if (!fileReader.result) {
            cleanVariablesAndVisual();
            console.log("El contenido del archivo no pudo ser leido.");
            alert("El contenido del archivo no pudo ser leido.");
            return;
        }

        let dataFileArray = readDataFromFile(fileReader.result);
        // Validate the format of the file and data
        if(!validateContent(dataFileArray[0])) {
            // Delete any info into the variables to avoid further errors
            cleanVariablesAndVisual();
            console.log("El archivo NO contiene información válida.");
            alert("El archivo NO contiene información válida.");
            return;
        }
        
        dataFileArray = deleteInvalidFinalLines(dataFileArray, dataFileArray[0].length);
        // Remove the headers from the loaded info
        dataFileArray.shift();
        dataFileArray = filterColumns(dataFileArray);
        contentOriginal = filterOrderTypeOnlyPUP(dataFileArray);
        
        selectedDate.disabled = false;
        selectedDate.classList.remove("disable");

        cutOffTimeSelector.disabled = false;
        cutOffTimeSelector.classList.remove("disable");

        serviceWindowSelector.disabled = false;
        serviceWindowSelector.classList.remove("disable");

        processDataB.disabled = false;
        processDataB.classList.remove("disable");
    }

    // *********************************************************
    // function to obtain all values of "CUT_OFF_TIME"  
    // function getCutOffTimeValues(dataArray) {
    //     const cutOffTimeValues = new Set();
    //     const optionsDestination = [];

    //     dataArray.forEach( (row) => { cutOffTimeValues.add(row[12]) });
    //     cutOffTimeValues.forEach( (item) => {optionsDestination.push(item) });
    //     optionsDestination.sort();
    //     return optionsDestination;
    // }

    // *********************************************************
    // Given an Array of "CUT_OFF_TIME" elements load those into the Dropdown list "Destination" 
    // function visualizeCutOffTimeOptions (dataArray) {
    //     cleanOptionsScrollDown(cutOffTimeSelector);

    //     // Get options from the file data.
    //     const optionsCutOffTime = getCutOffTimeValues(dataArray);
    //     optionsCutOffTime.unshift("");

    //     addOptionsScrollDown(cutOffTimeSelector, optionsCutOffTime);

    //     cutOffTimeSelector.disabled = false;
    //     cutOffTimeSelector.classList.remove("disable");
    //     return optionsCutOffTime;
    // }

    // *********************************************************
    // Function to get the "SERVICE_WINDOW" values for a "CUT_OFF_TIME" value
    // function visualizeServiceWindowOptions (){
    //     serviceWindowSelector.disabled = false;
    //     serviceWindowSelector.classList.remove("disable");

    //     let content = dataFilterByDate(contentOriginal );
        
        // if(!content) {
        //     // if the date is invalid, return and do nothing.
        //     return;
        // }

        // content = dataFilterByCutOffTime(content, this.value);
        
        // let serviceWindowOptions = getServiceWindowValues(content);

    //     console.log("SERVICE WINDOW OPTIONS ", serviceWindowOptions);


    //     showContent(content);

    // }

    // *********************************************************
    // function addOptionsScrollDown(scrollDownControl, optionsArray) {
    //         optionsArray.forEach( (element) => {
    //         const option = document.createElement("option");
    //         option.value = option.text = element;
    //         scrollDownControl.appendChild(option);
    //     });
    // }       
    // // *********************************************************
    // function cleanOptionsScrollDown(scrollDownControl ) {
    //     // Function to clean a given scroll down control options
    //     while(scrollDownControl.options.length > 0) {
    //         scrollDownControl.removeChild(scrollDownControl.firstElementChild);
    //     }
    // }


    // *********************************************************
    // function to join different orders with same "ISELL_NUMBER" in one "OrderPUP" object.
    function bindOrdersPUP_FromArray(arrayData) {
        const dataMap = new Map();
        arrayData.forEach( (row) => {
            // (pickArea, pickId, packages, weight, volume, orderedQty, actualOrderStatus, cancelled, notHandedOut )
            let pickTask = new PickOrder(row[1], row[3], row[4], row[5], row[6], row[7], row[8], row[9], row[10]);
            if(dataMap.has(row[0])) {
                console.log("Isell duplicado: ", row[0]);
                dataMap.get(row[0]).addPickOrder(pickTask);
            } else {
                let order = new OrderPUP(row[0], row[11], row[12], row[13], pickTask);
                dataMap.set(row[0], order);
            }
        });
        return dataMap;
    }

    // *********************************************************
    function processData() {

        const dateCutOffDate = validateDate();
        if(!dateCutOffDate) {
            return;
        }

        // console.log("contentOriginal inicial: ", contentOriginal.length);

        let content = dataFilterByDate(contentOriginal, dateCutOffDate);
        // console.log("data filter by date: ", content.length);

        const cutOffTime = cutOffTimeSelector.value;
        content = dataFilterByCutOffTime(content, CUT_OFF_TIME.get(cutOffTime));
        // console.log("data filter by cut off time (Destination): ", content.length);

        // console.log("CUTO OFF TIME value: ", cutOffTime);
        // console.log("VALOR de service window: ", serviceWindowSelector.value, );
        
        const windowServiceSelection = WINDOW_SERVICE.get(cutOffTime + serviceWindowSelector.value)
        // console.log("valor concatenado : ", windowServiceSelection );
        content = dataFilterByServiceWindow(content, windowServiceSelection );

        // Bind orders with the same "ISELL_ORDER_NUMBER"
        const dataMap = bindOrdersPUP_FromArray(content);

        // Calculate the totals for each "OrderPUP" 
        dataMap.forEach( function(value, key){
            value.calculateTotals();
        });

        printDocumentationB.disabled = false;
        printDocumentationB.classList.remove("disable");

        showContent(dataMap);
    }

    // *********************************************************
    // Function fo filter the data set by date
    function dataFilterByDate(dataArray, textDate) {
        return dataArray.filter( (row) => { return row[11] == textDate });
    }
    
    // *********************************************************
    // Function to filter data by "CUT_OFF_TIME" value selected
    function dataFilterByCutOffTime(dataArray, selection) {
        return dataArray.filter( (row) => { return row[12] === selection });
    }
    
    // *********************************************************
    function dataFilterByServiceWindow(dataArray, windowServiceArrayOptions) {

        console.log("Valor de window service: ", windowServiceArrayOptions);
        return dataArray.filter( row => {
            return windowServiceArrayOptions.includes(row[13]); 
        });
    }

    // *********************************************************
    function printDocument() {
        window.print();
    }







    // *********************************************************
    // function to obtain all values of "SERVICE_WINDOW"  
    // function getServiceWindowValues(dataArray) {
    //     const serviceWindow = new Set();
    //     const options = [];

    //     dataArray.forEach( (row) => { serviceWindow.add(row[13]) });
    //     serviceWindow.forEach( (item) => {options.push(item) });
    //     options.sort();
    //     return options;
    // }

    // *********************************************************
    // Function to round a value for better presentation
    function roundValue(value) {
        value *= 100;
        value = Math.round(value); 
        return (value / 100);
    }
    // *********************************************************
    function showContent(data) {
        // Clean and initialize values for the table data view
        tableBody.innerHTML = "";
        let dataTableBody = "";
        let count = 1;
        let totalPakagesShipment = 0;
        let totalWeightShipment = 0;
        let totalVolumeShipment = 0;
        
        console.log("Data en showContent ", data);

        data.forEach( (value, key) => {

            const isReturned = (value.status === RETURNED) ? "warning-row" : "";

            dataTableBody += "<tr class='centrar " + isReturned + "'>";
            dataTableBody += "<td>";
            dataTableBody += count;
            dataTableBody += "</td>";
            dataTableBody += "<td>";
            dataTableBody += value.isellOrderNumber;
            dataTableBody += "</td>";
            dataTableBody += "<td class='hide-print'>";
            dataTableBody += value.status;
            dataTableBody += "</td>";
            dataTableBody += "<td>";
            let temp = roundValue(value.totalPackages);
            totalPakagesShipment += temp;
            dataTableBody += temp;
            dataTableBody += "</td>";
            dataTableBody += "<td>";
            temp = roundValue(value.totalWeight);
            totalWeightShipment += temp,
            dataTableBody += temp;
            dataTableBody += "</td>";
            dataTableBody += "<td>";
            temp = roundValue(value.totalVolume );
            totalVolumeShipment += temp;
            dataTableBody += temp;
            dataTableBody += "</td>";

            count++;
        });

        dataTableBody += "<tr class='centrar totales'>";
        dataTableBody += "<td class='hide-print'></td>"
        dataTableBody += "<td colspan='2'>Totales</td>";
        dataTableBody += "<td>" + roundValue(totalPakagesShipment) + " bultos</td>";
        dataTableBody += "<td>" + roundValue(totalWeightShipment) + " Kgs</td>";
        dataTableBody += "<td>" + roundValue(totalVolumeShipment) + " m<sup>3</sup></td>";

        tableBody.innerHTML += dataTableBody;
    }
    
    // *********************************************************
    function cleanVariablesAndVisual() {
        content = contentOriginal = [];
        document.getElementById("upload-file-b").innerText = "Subir archivo...";
        showContent(content);
    }

    </script>
</body>
</html>