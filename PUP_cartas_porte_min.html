<!DOCTYPE html><html lang=es><head><meta charset=UTF-8 /><meta http-equiv=X-UA-Compatible content="IE=edge" /><meta name=viewport content="width=device-width, initial-scale=1.0" /><meta name=autor content=https://github.com/perseo1326 /><title>PUP Cartas de Porte</title><link rel=preconnect href=https://fonts.googleapis.com /><link rel=preconnect href=https://fonts.gstatic.com crossorigin /><link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400;700&display=swap" rel=stylesheet /><style>*,*:after,*:before{--background:white;--first-color:#0057a4;--second-color:#ffdb01;--warning-color:rgba(255,165,0,1);--doc-font:8px;padding:0;margin:0;font-family:'Roboto',sans-serif;font-size:16px;box-sizing:border-box}.warning{background-color:var(--warning-color)}body{background-color:var(--background);padding:.5rem}.back1{background-color:#0ff}.back2{background-color:#ffa500}div.panel{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5)}div.panel div.frame{margin:auto;width:40%;background-color:#f5f5f5;border-radius:4px}div.panel div.frame div.frame-title h3{background-color:var(--first-color);color:var(--second-color);text-align:center;padding:.5rem;font-size:1.5rem;border-top-left-radius:4px;border-top-right-radius:4px}div.panel div.frame div.frame-content{padding:.5rem}div.panel div.frame div.frame-content div p span{text-decoration:underline;display:inline-block;margin-bottom:.3rem;color:var(--first-color)}div.container-column{padding:0 .5rem;display:flex;flex-direction:column}.container{display:flex}.no-visible{display:none}.show-print{display:none}.inline{display:inline-block}.margen-alto-05{margin-top:.5rem}.margen-izq-1{margin-left:1rem}.ancho-100{width:100%}.ancho-50{width:50%}.ancho-60{width:60%}.margen-bajo-05{margin-bottom:.5rem}.margen-bajo-1{margin-bottom:1rem}.centrar{text-align:center}h1{font-size:2rem}label{display:inline-block}div p.version{text-align:right;padding:.3rem 1rem;font-size:var(--doc-font);color:#808080}.custom-button{border:1px solid var(--first-color);border-radius:4px;background-color:var(--first-color);color:var(--second-color);cursor:pointer;font-size:1rem;margin:.3rem auto;padding:.3rem .6rem;text-align:center}.custom-button:hover{background-color:var(--second-color);color:var(--first-color);border:1px solid var(--first-color)}.disable{background-color:#d3d3d3;color:#000;cursor:not-allowed}.disable:hover{background-color:#d3d3d3;color:#ff4500}input[type="file"]{display:none}div.resume{border:2px solid var(--first-color)}div.resume p{padding:0 1rem .2rem 1rem}div.resume p span{color:var(--first-color);font-weight:bold}div.resume p:hover{background-color:#ffdb01}div.report-info{background-color:#ffdb01;margin-bottom:.5rem}strong{font-weight:bold}table{width:100%;border-collapse:collapse;border:2px solid var(--first-color)}thead tr th{padding:.1rem;border-bottom:2px solid var(--first-color)}thead tr th.ordinal{width:4rem}thead tr th.isell{width:20%}table tbody#data-body tr.warning-row{background-color:#ffa500 !important}table tbody#data-body tr td{border-bottom:1px solid #808080;min-width:5rem;max-height:1rem}table tbody#data-body tr:nth-last-of-type(2n+0){background-color:#d3d3d3}table tbody#data-body tr:hover{background-color:var(--second-color)}.cabecera{background-color:var(--first-color);color:var(--second-color)}table tbody#data-body tr.totales{font-weight:bolder}table tbody#transport-document-info tr td.title{border-right:1px solid transparent}table tbody#transport-document-info tr td.page-number{font-size:var(--doc-font);text-align:right;padding:0 .5rem;vertical-align:top}table tbody#transport-document-info tr td h3{text-align:right;padding:.5rem;font-size:large}table tbody#transport-document-info tr td{font-size:var(--doc-font);padding:.2rem;border:1px solid #000}table tbody#transport-document-info tr td.value{text-align:center;font-size:small}table tbody#transport-document-info tr td p.note{font-size:var(--doc-font);text-align:justify}table tbody#transport-document-info tr td.text-top-left{text-align:left;vertical-align:text-top}.blank-space{height:6rem}.blank-space-big{height:9rem}table tbody#footer-table tr td{font-size:var(--doc-font);padding:.2rem;border:1px solid #000}div p.footer-page{font-size:var(--doc-font);font-style:italic;text-align:right}@media print{*,*:after,*:before{--background:transparent;--first-color:#000;--second-color:#000;font-size:12px}body,html{background-color:transparent !important;color:#000 !important}.hide-print{display:none !important}.show-print{display:block}.cabecera{print-color-adjust:exact;-webkit-print-color-adjust:exact;background-color:#aaa7a7}table tbody#data-body tr td{background-color:transparent}table.print-hide-borders{border-top:0;border-bottom:0}p.version{print-color-adjust:exact;-webkit-print-color-adjust:exact}}</style></head><body class=page-a4><div class=container-column><div id=panel class=panel><div class=frame><div class=frame-title><h3>Fecha de envío</h3></div><div class=frame-content><div class=margen-bajo-05><p>Destino: <span id=frame-destination></span></p><label for="">Seleccionar fecha de envío:</label><div class=container><input type=date id=frame-shipping-date class="custom-button centrar" /></div></div><div class=container><input type=button id=frame-ok-b class=custom-button value=Continuar /><input type=button id=frame-cancel-b class=custom-button value=Cancelar /></div></div></div></div><div class="hide-print ancho-100 margen-bajo-1"><h1 class=centrar>Cartas de Porte Pick Up Points</h1></div><div class="hide-print margen-bajo-05 ancho-100"><div class=ancho-100><label for="">1. Seleccionar archivo de datos:</label><div class="ancho-100 margen-izq-1"> <label class=custom-button id=upload-file-b for=file-input>Subir archivo...</label><input type=file id=file-input /></div></div><div class=ancho-100><label for="">2. Fecha (CUT OFF DATE):</label><div class="ancho-100 margen-izq-1"><input type=date id=selected-date class="custom-button disable" disabled /></div></div><div class=container><div class="ancho-50 inline"><label for="">3. Seleccione el destino (CUT OFF TIME):</label><div class="ancho-100 margen-izq-1"><select id=destino-cut-off-time name=destinos class="custom-button disable" disabled><option value="">Selecciona una opción</option></select></div></div><div class="ancho-50 inline"><label for="">4. Seleccione el Service Window:</label><div class="ancho-100 margen-izq-1"><select id=service-window name="" class="custom-button disable" disabled><option value="">Selecciona una opción</option></select></div></div></div><div class="ancho-50 inline"><label for="">5. Analizar información</label><div class="ancho-100 margen-izq-1"><input type=button id=process-data class="custom-button disable" value="Procesar información" disabled /></div></div><div class="ancho-50 inline"><label for="">6. Imprimir Documentación</label><div class="ancho-100 margen-izq-1"><input type=button id=print-documentation-b class="custom-button disable" value="Imprimir Documentación" disabled /></div></div></div><div id=cabecero class=show-print><table><tbody id=transport-document-info><tr><td class="ancho-50 title"><h3>Carta de Porte / Transport Document</h3></td><td class=page-number colspan=2>Página 1 de 1<br />Page 1 of 1</td></tr><tr><td>No. Carta de porte / Transport document number</td><td>Fecha de carga / Date of loading</td><td>Fecha de entrega / Date of receipt</td></tr><tr><td id=transport-document-number class=value></td><td id=transport-document-loading-date class=value></td><td id=transport-document-receipt-date class=value></td></tr><tr><td>Remitente / Sender</td><td colspan=2>No. de precinto</td></tr><tr><td id=sender-address></td></tr><tr><td>Destinario / Consignee</td><td colspan=2>Transportista / Carrier</td></tr><tr><td id=consignee-address></td><td id=carrier-address colspan=2></td></tr><tr><td>Número de albarán / Invoice number</td><td colspan=2>Matrícula Vehículo / Trailer registration</td></tr><tr><td class=blank-space></td><td class=blank-space colspan=2></td></tr><tr><td><p class=note>El conductor, mediante su firma declara que durante las operaciones de carga se ha seguido una relación de comprobaciones relativa a la carga de las mercancías peligrosas, habiendo iniciado el transporte cumpliendo con todos los requisitos exigibles por el ADR.</p><p class=note>The driver, by signing states that during the loading a dangerous goods check-list has been completed, initiating transport in compliance with all applicable requirements of the ADR.</p></td><td class=text-top-left colspan=2>Firma del conductor / Driver's signature</td></tr></tbody></table></div><div id=resume class="resume no-visible hide-print"><p>Fecha (CUT OFF DATE): <span id=resume-cut-off-date></span></p><p>Destino (CUT OFF TIME): <span id=resume-cut-off-time></span></p><p>Service Window: <span id=resume-service-window></span></p></div><div><table class=print-hide-borders><thead><tr class=cabecera><th class="centrar ordinal">No.</th><th class=isell>Isell</th><th class=hide-print>Estado</th><th>No. Paquetes</th><th>Peso (Kg)</th><th>Volumen (m<sup>3</sup>)</th></tr></thead><tbody id=data-body></tbody></table></div><div class=show-print><table><tbody id=footer-table><tr><td class=centrar colspan=3>Observaciones de la expedición / Shipping remarks</td></tr><tr><td class=blank-space colspan=3></td></tr><tr><td>Firma y sello Expedidor</td><td>Firma y sello Transportista</td><td>Firma y sello Destinatario</td></tr><tr><td class=blank-space-big></td><td class=blank-space-big></td><td class=blank-space-big></td></tr></tbody></table><div><p class=footer-page>Imprimir 3 copias: 1 Consignatario, 1 transportista y 1 receptor.</p></div></div></div><div><p class=version>Versión 1.0 - (https://github.com/perseo1326)</p></div><script>function R(n,t,i){const r=document.createElement("option");r.value=t;r.text=i;n.appendChild(r)}function S(n){n.options.length>0&&(n.remove(0),S(n))}function b(){typeof e=="undefined"&&(console.log("No fue posible cargar la configuración inicial."),alert("No fue posible cargar la configuración inicial."));e.forEach(n=>{R(c,n.t,n.title)})}function P(n){return e.find(t=>t.t===n)}function _(){S(i);R(i,v.value,v.text);const n=P(this.value);n&&n.m.forEach(n=>{R(i,n.h,n.p)})}function F(n){const t=n.valueAsDate;return t?n.value:(console.log("La fecha seleccionada es inválida."),alert("La fecha seleccionada es inválida."),!1)}function w(n){return n?n:(alert("No se ha seleccionado ningun archivo."),console.log("No se ha seleccionado ningun archivo."),null)}function W(n){console.clear();let t=n.target.files[0];(t=w(t),t)&&(m.readAsText(t,"windows-1252"),document.getElementById("upload-file-b").innerText=t.name,m.onload=z)}function x(n){let r=n.split("\n"),t=[],i=[];return r.forEach(n=>{t=n.split("\t"),i.push(t)}),i}function j(n){return n[0].trim()=="ISELL_ORDER_NUMBER"&&n[1].trim()=="PICK_ID"&&n[3].trim()=="ORDER_TYPE"&&n[5].trim()=="PACKAGES"&&n[6].trim()=="WEIGHT"&&n[7].trim()=="VOLUME"&&n[12].trim()=="PICK_AREA"&&n[38].trim()=="CUT_OFF_DATE"&&n[39].trim()=="CUT_OFF_TIME"&&n[42].trim()=="SERVICE_WINDOW"?!0:!1}function G(n,t){return n[n.length-1].length<t&&(n.pop(),G(n,t)),n}function q(n){let t=[];return n.forEach(n=>{const i=[];i.push(n[0].trim());i.push(n[1].trim());i.push(n[5].trim());i.push(n[6].trim());i.push(n[7].trim());i.push(n[12].trim());i.push(n[13].trim());i.push(n[38].trim());i.push(n[39].trim());i.push(n[42].trim());t.push(i)}),t}function Y(n){return n.filter(n=>n[3].trim()==="PUP")}function z(){if(!m.result){L();console.log("El contenido del archivo no pudo ser leido.");alert("El contenido del archivo no pudo ser leido.");return}let n=x(m.result);if(!j(n[0])){L();console.log("El archivo NO contiene información válida.");alert("El archivo NO contiene información válida.");return}n=G(n,n[0].length);n.shift();n=Y(n);p=q(n);s.disabled=!1;s.classList.remove("disable");c.disabled=!1;c.classList.remove("disable");i.disabled=!1;i.classList.remove("disable");t.disabled=!1;t.classList.remove("disable")}function J(n){const t=new Map;return n.forEach(n=>{let i=new N(n[1],n[2],n[3],n[4],n[5],n[6]);if(t.has(n[0]))t.get(n[0]).U(i);else{let r=new O(n[0],n[7],n[8],n[9],i);t.set(n[0],r)}}),t}function Q(){const f=F(s);if(f){const n=P(c.value);if(!n){console.log("No se ha seleccionado un destino (CUT OFF TIME)");alert("No se ha seleccionado un destino (CUT OFF TIME)");return}const t=n.m.find(n=>n.h===i.value);if(!t){console.log('No se ha seleccionado un "Service Window" válido.');alert('No se ha seleccionado un "Service Window" válido.');return}h=t;let r=X(p,f);r=Z(r,n.o);r=$(r,t.g);const e=J(r);e.forEach(function(n){n.B()});d.disabled=!1;d.classList.remove("disable");document.getElementById("resume").classList.remove("no-visible");const o=new Date(f);document.getElementById("resume-cut-off-date").innerText=o.toLocaleDateString();document.getElementById("resume-cut-off-time").innerText=n.title+" ("+n.o+")";document.getElementById("resume-service-window").innerText=t.p+" ("+t.g+")";u.innerText=n.title+" - "+t.p;C(document.getElementById("sender-address"),n.i);C(document.getElementById("consignee-address"),n.u);C(document.getElementById("carrier-address"),n.l);B(e)}}function X(n,t){return n.filter(n=>n[7]===t)}function Z(n,t){return n.filter(n=>n[8]===t)}function $(n,t){return n.filter(n=>t.includes(n[9]))}function ee(){o.style.display="flex";r.value="----------"}function ne(){const t=F(r);if(t){const n=new Date(t);document.getElementById("transport-document-number").innerText=h.T+n.toLocaleDateString()+h.v;document.getElementById("transport-document-loading-date").innerText=n.toLocaleDateString();document.getElementById("transport-document-receipt-date").innerText=n.toLocaleDateString();o.style.display="none";window.print()}}function C(n,t){I(n);const i=document.createElement("p"),r=document.createElement("strong");r.innerText=t[0];i.appendChild(r);n.appendChild(i);for(let i=1;i<t.length;i++){const u=t[i],r=document.createElement("p");r.innerText=u;n.appendChild(r)}}function I(n){n.childNodes.length>0&&(n.lastChild.remove(),I(n))}function U(n){return n*=100,n=Math.round(n),n/100}function B(n){f.innerHTML="";let t="",i=1,r=0,u=0,e=0;console.log("Data en showContent ",n);n.forEach(n=>{const o=n.status===A?"warning-row":"";t+="<tr class='centrar "+o+"'>";t+="<td>";t+=i;t+="<\/td>";t+="<td>";t+=n.S;t+="<\/td>";t+="<td class='hide-print'>";t+=n.status;t+="<\/td>";t+="<td>";let f=U(n.G);r+=f;t+=f;t+="<\/td>";t+="<td>";f=U(n.C);u+=f;t+=f;t+="<\/td>";t+="<td>";f=U(n.I);e+=f;t+=f;t+="<\/td>";i++});t+="<tr class='centrar totales'>";t+="<td class='hide-print'><\/td>";t+="<td colspan='2'>Totales<\/td>";t+="<td>"+U(r)+" bultos<\/td>";t+="<td>"+U(u)+" Kgs<\/td>";t+="<td>"+U(e)+" m<sup>3<\/sup><\/td>";f.innerHTML+=t}function L(){console.log("Limpiando variables y visuales");content=p=[];h={};b();document.getElementById("upload-file-b").innerText="Subir archivo...";B(content)}const e=[{t:"DIAGONAL",title:"Diagonal",o:"20:15",i:["IKEA Gran Via 406","Gran Via de l'Hospitalet 115-133","Hospitalet de Llobregat 08908","Barcelona, Espanya"],u:["PUP Travessera (PUPT-BCN)","C/ Travessera de Gracia 12","08012 - Barcelona (Barcelona)","Spain"],l:["ABIAN SERVICE","Tel: 931161444","Email: opsbarcelona@abianservice.com"],m:[{p:"Primera Furgo",h:"FURGO_ONE",T:"406PUPT-",v:"(Furgo 1)",g:["10:00-12:00","12:00-15:00"]},{p:"Segunda Furgo",h:"FURGO_TWO",T:"406PUPT-",v:"(Furgo 2)",g:["15:00-18:00"]},{p:"Tercera Furgo",h:"FURGO_THREE",T:"406PUPT-",v:"(Furgo 3)",g:["18:00-21:00"]}]},{t:"SANT_PERE",title:"Sant Pere",o:"20:00",i:["IKEA Gran Via 406","Gran Via de l'Hospitalet 115-133","Hospitalet de Llobregat 08908","Barcelona, Espanya"],u:["IKEA St Pere Planning Studio","Rambla del Garraf s/n, Parc d'Oci Les Roquetes Local 10-B2","El Mas d'en Serra, 08812","Barcelona, Espanya"],l:["SAMA Logística Aplicada SL","Gran Via de l'Hospitalet 115-133","Hospitalet de Llobregat 08908","Barcelona, Espanya"],m:[{p:"Primera Furgo",h:"FURGO_ONE",T:"406SP ",v:" SANT PERE (FURGO 1)",g:["10:00-13:00","13:00-16:00"]},{p:"Segunda Furgo",h:"FURGO_TWO",T:"406SP ",v:" SANT PERE (FURGO 2)",g:["16:00-19:00","19:00-21:00"]}]},{t:"TARRAGONA",title:"Taragona",o:"19:45",i:["IKEA Gran Via 406","Gran Via de l'Hospitalet 115-133","Hospitalet de Llobregat 08908","Barcelona, Espanya"],u:["IKEA Tarragona Planning Studio","Avenida Ramón y Cajal 155","Tarragona, 43005","Tarragona, Espanya"],l:["SAMA Logística Aplicada SL","Gran Via de l'Hospitalet 115-133","Hospitalet de Llobregat 08908","Barcelona, Espanya"],m:[{p:"Primera Furgo",h:"FURGO_ONE",T:"406TGN ",v:" FURGO 1",g:["10:00-13:00","13:00-17:00"]},{p:"Segunda Furgo",h:"FURGO_TWO",T:"406TGN ",v:" FURGO 2",g:["17:00-19:00","19:00-21:00"]}]}],n=document.getElementById("file-input"),s=document.getElementById("selected-date"),c=document.getElementById("destino-cut-off-time"),i=document.getElementById("service-window"),t=document.getElementById("process-data"),d=document.getElementById("print-documentation-b"),o=document.getElementById("panel"),u=document.getElementById("frame-destination"),r=document.getElementById("frame-shipping-date"),a=document.getElementById("frame-ok-b"),l=document.getElementById("frame-cancel-b"),f=document.getElementById("data-body"),m=new FileReader;let p=[],h={};const T=new Date,v={value:"",text:"Selecciona una opción"},V="Not Started",g="Started",k="Picking",y="Picked",D="Wait for Merge",H="Check Started",M="Checked",K="Completed",E="Open Return",A="Returned";class N{constructor(n,t,i,r,u,f){this.A=u;this.N=n;this.O=Number(t.replace(",","."));this.weight=Number(i.replace(",","."));this.volume=Number(r.replace(",","."));this.R=f}}class O{constructor(n,t,i,r,u){this.S=n;this.P=t;this.o=i;this._=r;this.F=new Map;this.F.set(u.A,u);this.G=Number(0);this.C=Number(0);this.I=Number(0);this.status=g}U(n){if(this.F.has(n.A)){console.log("ERROR: picking task ya existente! ID = "+n.N);alert("ERROR: picking task ya existente! ID = "+n.N);return}this.F.set(n.A,n)}B(){(this.G=0,this.C=0,this.I=0,this.L(),this.status!==A)&&this.F.forEach(n=>{this.G+=n.O,this.C+=n.weight,this.I+=n.volume})}L(){this.F.forEach(n=>{(n.R===E||n.R===A)&&(this.status=A)})}}s.valueAsDate=T;b();n.addEventListener("change",W);t.addEventListener("click",Q);d.addEventListener("click",ee);c.addEventListener("change",_);a.addEventListener("click",ne);l.addEventListener("click",()=>{o.style.display="none"})</script></body></html>